FROM alpine:latest

# 接受版本参数
ARG VERSION
ENV VERSION=${VERSION}

# 安装必要的依赖
RUN apk --no-cache add ca-certificates tzdata
RUN ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime

# 创建应用目录
WORKDIR /app

# 复制带版本号的可执行文件
COPY cronjob-app-v${VERSION} ./cronjob-app

# 创建配置目录
RUN mkdir -p /app/config

# 设置环境变量默认值
ENV APP_ENV=production
ENV APP_CONFIG_PATH=/app/config/config.yaml

# 暴露端口
EXPOSE 8082

# 启动命令，支持环境变量配置
CMD ["/app/cronjob-app", "-config=${APP_CONFIG_PATH}", "-env=${APP_ENV}"]