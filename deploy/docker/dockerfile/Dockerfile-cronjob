# 使用轻量级基础镜像
FROM alpine:3.18

# 安装 CA 证书（用于 HTTPS 请求）
RUN apk --no-cache add ca-certificates tzdata && \
    # 设置时区
    cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime && \
    echo "Asia/Shanghai" > /etc/timezone && \
    # 清理缓存
    rm -rf /var/cache/apk/*

# 创建非 root 用户运行应用
RUN addgroup -g 1000 appuser && \
    adduser -D -u 1000 -G appuser appuser

# 创建工作目录
WORKDIR /app

# 复制可执行文件
COPY app/projects/cronjob/cronjob-app /app/

# 复制配置文件
COPY app/projects/cronjob/config /app/config/

# 设置文件权限
RUN chown -R appuser:appuser /app && \
    chmod +x /app/cronjob-app

# 切换到非 root 用户
USER appuser

# 暴露端口（如果需要）
 EXPOSE 8082

# 设置启动命令
CMD ["/app/cronjob-app", "-config=./config/config.yaml", "-env=product"]